---
# defaults file for ansible-prometheus-node-exporter

PROMETHEUS_NODE_EXPORTER_VERSION: '0.15.0'
PROMETHEUS_NODE_EXPORTER_PACKAGE_CHECKSUM: '9413b3c94dbe9d4341ce85ea7e3f0e20abb8804135b8c236c4440c2c841551d7'
PROMETHEUS_NODE_EXPORTER_OS: 'linux'
PROMETHEUS_NODE_EXPORTER_ARCH: 'amd64'

PROMETHEUS_NODE_EXPORTER_REPO: 'https://github.com/prometheus/node_exporter.git'

PROMETHEUS_NODE_EXPORTER_GROUP: 'prometheus'
PROMETHEUS_NODE_EXPORTER_USER: 'prometheus'

PROMETHEUS_NODE_EXPORTER_DIRS:
  PROMETHEUS_BINARIES_DIR: '/opt/prometheus'
  PROMETHEUS_CONFIGS_DIR: '/etc/prometheus'
  PROMETHEUS_LOGS_DIR: '/var/log/prometheus'
  PROMETHEUS_TEXTFILE_COLLECTOR_DIR: '/var/lib/prometheus/node_exporter/textfile_collector'

PROMETHEUS_NODE_EXPORTER_DIR: '/opt/node_exporter'
PROMETHEUS_NODE_EXPORTER_CONF_DIR: '/etc/node_exporter'
PROMETHEUS_NODE_EXPORTER_LOG_DIR: '/var/log/node_exporter'
PROMETHEUS_TEXTFILE_COLLECTOR_DIR: '/var/lib/prometheus/node_exporter/textfile_collector'

PROMETHEUS_NODE_EXPORTER_DIR_NAME: 'node_exporter-{{ PROMETHEUS_NODE_EXPORTER_VERSION }}.{{ PROMETHEUS_NODE_EXPORTER_OS }}-{{ PROMETHEUS_NODE_EXPORTER_ARCH }}'

PROMETHEUS_CONFIG_FILE_NAME: 'prometheus.yml'

PROMETHEUS_NODE_EXPORTER_PORT: '9100'

# Designed to work with https://gitlab.cyverse.org/config-mgmt/ansible-install-megacli
PROMETHEUS_NODE_EXPORTER_MONITOR_STORCLI: false

# The mv commands ensure atomicity
PROMETHEUS_NODE_EXPORTER_STORCLI_STAT_COLLECTION_COMMAND: >
  {{ PROMETHEUS_NODE_EXPORTER_DIRS.PROMETHEUS_BINARIES_DIR }}/storcli.py > {{ PROMETHEUS_NODE_EXPORTER_DIRS.PROMETHEUS_TEXTFILE_COLLECTOR_DIR }}/storcli.prom.$$ && mv {{ PROMETHEUS_NODE_EXPORTER_DIRS.PROMETHEUS_TEXTFILE_COLLECTOR_DIR }}/storcli.prom.$$ {{ PROMETHEUS_NODE_EXPORTER_DIRS.PROMETHEUS_TEXTFILE_COLLECTOR_DIR }}/storcli.prom && echo storcli_collection_time $(date +\%s) > {{ PROMETHEUS_NODE_EXPORTER_DIRS.PROMETHEUS_TEXTFILE_COLLECTOR_DIR }}/storcli_collection_time.prom.$$ && mv {{ PROMETHEUS_NODE_EXPORTER_DIRS.PROMETHEUS_TEXTFILE_COLLECTOR_DIR }}/storcli_collection_time.prom.$$ {{ PROMETHEUS_NODE_EXPORTER_DIRS.PROMETHEUS_TEXTFILE_COLLECTOR_DIR }}/storcli_collection_time.prom

PROMETHEUS_NODE_EXPORTER_MANAGE_FW: true
